---
# yaml-language-server: $schema=https://raw.githubusercontent.com/zarf-dev/zarf/main/zarf.schema.json
kind: ZarfPackageConfig
metadata:
  name: fluxcd
  version: "###ZARF_PKG_TMPL_VERSION###"
  source: https://github.com/colonel-byte/zarf-pkg-fluxcd
  annotations:
    org.opencontainers.image.source: https://github.com/colonel-byte/zarf-pkg-fluxcd
    org.opencontainers.image.description: Zarf package for deploying fluxcd
components:
  - name: fluxcd-core
    required: true
    only:
      flavor: upstream
    manifests:
      - name: fluxcd
        namespace: flux-system
        kustomizations:
          - upstream/core
    images:
      - ghcr.io/fluxcd/helm-controller:v1.4.3
      - ghcr.io/fluxcd/kustomize-controller:v1.7.2
      - ghcr.io/fluxcd/notification-controller:v1.7.4
      - ghcr.io/fluxcd/source-controller:v1.7.3
  - name: fluxcd-image-controller
    required: false
    only:
      flavor: upstream
    manifests:
      - name: fluxcd
        namespace: flux-system
        kustomizations:
          - upstream/images
    images:
      - ghcr.io/fluxcd/image-automation-controller:v1.0.3
      - ghcr.io/fluxcd/image-reflector-controller:v1.0.3
  - name: fluxcd-source-watcher
    required: false
    only:
      flavor: upstream
    manifests:
      - name: fluxcd
        namespace: flux-system
        kustomizations:
          - upstream/source
    images:
      - ghcr.io/fluxcd/source-watcher:v2.0.2
  - name: fluxcd-core
    required: true
    only:
      flavor: registry1
    manifests:
      - name: fluxcd
        namespace: flux-system
        kustomizations:
          - registry1/core
    images:
      - registry1.dso.mil/ironbank/fluxcd/helm-controller:v1.4.3
      - registry1.dso.mil/ironbank/fluxcd/kustomize-controller:v1.7.2
      - registry1.dso.mil/ironbank/fluxcd/notification-controller:v1.7.4
      - registry1.dso.mil/ironbank/fluxcd/source-controller:v1.7.3
  - name: fluxcd-image-controller
    required: false
    only:
      flavor: registry1
    manifests:
      - name: fluxcd
        namespace: flux-system
        kustomizations:
          - registry1/images
    images:
      - registry1.dso.mil/ironbank/fluxcd/image-automation-controller:v1.0.3
      - registry1.dso.mil/ironbank/fluxcd/image-reflector-controller:v1.0.3
# the image does not exist in ironbank as of 11/02/2025
# - name: fluxcd-source-watcher
#   required: false
#   only:
#     flavor: registry1
#   manifests:
#     - name: fluxcd
#       namespace: flux-system
#       kustomizations:
#         - registry1/source
#   images: []
